$(document).ready(function() {
    $('#consultationForm').on('submit', function(event) {
        event.preventDefault(); // 기본 제출 동작 방지

        // 입력값 유효성 검사
        var valid = true;
        var errorMessage = '';

        // 비밀번호 형식 검사
        var password = $('#consultantPassword').val();
        if (!/^(?=.*\d)(?=.*[a-zA-Z]).{6,20}$/.test(password)) {
            errorMessage += '비밀번호는 6~20자, 숫자와 영문자 조합이어야 합니다.\n';
            valid = false;
        }

        // 이름 형식 검사
        var name = $('#consultantName').val();
        if (!/^[가-힣a-zA-Z\s]{2,20}$/.test(name)) {
            errorMessage += '이름은 2~20자의 한글 또는 영문만 가능합니다.\n';
            valid = false;
        }

        // 이메일 형식 검사
        var email = $('#consultantEmail').val();
        if (!/\S+@\S+\.\S+/.test(email)) {
            errorMessage += '유효한 이메일 주소를 입력하세요.\n';
            valid = false;
        }

        // 문의 유형 선택 필수 확인
        if ($('#consultationType').val() === "") {
            errorMessage += '문의 유형을 선택하세요.\n';
            valid = false;
        }

        if (!valid) {
            alert(errorMessage); // 오류 메시지 출력
            return; // 유효하지 않을 경우 종료
        }

		var username = "[[${username}]]"; // Thymeleaf 문법 사용

		// 입력 데이터 수집
		var requestData = {
		    consultationType: $('#consultationType').val(),
		    consultantName: username, // 컨트롤러에서 받은 사용자 이름 저장
		    consultantEmail: $('#consultantEmail').val(),
		    consultantMessage: $('#consultantMessage').val(),
		    consultantPassword: $('#consultantPassword').val()
		};

		// AJAX 요청
		$.ajax({
		    url: '/inquiry/success', // 컨트롤러의 URL
		    type: 'POST', // POST 메서드
		    contentType: 'application/json', // 요청 데이터 형식
		    data: JSON.stringify(requestData), // 객체를 JSON 문자열로 변환
		    success: function(response) {
		        // 성공 시 메시지 출력
		        alert(response); // 성공 메시지
		        $('#consultationForm')[0].reset(); // 폼 초기화
		    },
		    error: function(xhr, status, error) {
		        // 오류 발생 시 메시지 출력
		        alert('상담 요청 처리 중 오류가 발생했습니다: ' + xhr.responseText);
		    }
		});
    });
});