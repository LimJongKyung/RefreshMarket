<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" class="h-100" data-bs-theme="auto">
	<head>
	    <th:block th:insert="~{template/refresh/fragments/block :: config}"></th:block>
	    <meta name="theme-color" content="#712cf9">
	    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
	    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
	    <link href="/assets/dist/css/refreshmain.css" rel="stylesheet">
	    <link href="/assets/dist/mainproductboardcss/Purchase.css" rel="stylesheet">
	</head>
	<body class="d-flex h-100 text-center text-bg-dark">
	    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
	        <header class="mb-auto">
	            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
	                <th:block th:insert="~{template/refresh/fragments/blocklogin :: header}"></th:block>
	                <th:block th:insert="~{template/refresh/fragments/blocklogin :: brandName}"></th:block>
	                <th:block th:insert="~{template/refresh/fragments/blocklogin :: mainNavbar}"></th:block>
	                <th:block th:insert="~{template/refresh/fragments/blocklogin :: sideNavbar}"></th:block>
	            </nav>
	        </header>
	    </div>    
	    <main style="max-width:600px; margin: 40px auto; padding: 0 20px; font-family: 'Noto Sans KR', sans-serif;">
		  <h2 style="text-align:center; margin-bottom:30px;" th:text="'구매자, ' + ${username} + ' 고객님!'"></h2>
		
		  <!-- 기존 정보 불러오기 체크박스 -->
		  <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
		    <input type="checkbox" id="loadExistingInfo">
		    기존 정보 불러오기
		  </label>
		
		  <form id="guestOrderForm" action="/products/order" method="post" style="display: flex; flex-direction: column; gap: 15px;">
		    <input type="hidden" id="customerId" name="customerId" th:value="${userId}" />
		    
		    <label>
		      이름
		      <input type="text" id="customerName" name="customerName" required placeholder="이름을 입력하세요" style="width:100%; padding:8px; font-size:1rem;"/>
		    </label>
		
		    <label>
		      이메일
		      <input type="email" id="email" name="email" required placeholder="이메일을 입력하세요" style="width:100%; padding:8px; font-size:1rem;"/>
		    </label>
		
		    <label>
		      전화번호
		      <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="전화번호를 입력하세요" style="width:100%; padding:8px; font-size:1rem;"/>
		    </label>
		
		    <label>
		      배송 주소
		      <button type="button" onclick="execDaumPostcode()" style="padding:8px 12px; font-size:1rem; background-color:#007bff; color:#fff; border:none; border-radius:4px; cursor:pointer; margin-bottom:10px;">
		        주소 검색
		      </button>
		      <input type="text" id="roadAddress" placeholder="주소검색" readonly style="width:100%; padding:8px; margin-bottom:10px;" />
		      <input type="text" id="detailAddress" placeholder="상세 주소를 입력하세요" style="width:100%; padding:8px;" />
		      
		      <!-- 서버 전송용 hidden input -->
		      <input type="hidden" name="shippingAddress" id="shippingAddress" />
		    </label>
		
		    <label>
		      배송 요청사항
		      <input type="text" name="deliveryRequest" placeholder="배송 요청사항이 있으면 입력하세요" style="width:100%; padding:8px; font-size:1rem;"/>
		    </label>
		
		    <label>
		      결제 방법
		      <select name="paymentMethod" required style="width:100%; padding:8px; font-size:1rem;">
		        <option value="" disabled selected>결제 방법을 선택하세요</option>
		        <option value="카드">카드</option>
		        <option value="계좌이체">계좌이체</option>
		      </select>
		    </label>
		
			<!-- 보유 포인트 표시 -->
			<p>보유 포인트: <span id="memberPointValue" th:text="${memberInfo.point ?: 0}">0</span>원</p>
			
			<!-- 사용할 포인트 입력 -->
			<label>
			  사용할 포인트
			  <input type="number" id="usedPoint" name="usedPoint" min="0" placeholder="사용할 포인트를 입력하세요" style="width:100%; padding:8px; font-size:1rem;" />
			</label>
			
		    <!-- 쿠폰 선택 영역 -->
		    <div class="user-benefits">
		      <h3>🎁 쿠폰 사용</h3>
		      <select id="benefitSelector">
		        <option value="">-- 쿠폰을 선택하세요 --</option>
		        <option th:each="benefit : ${benefits}"
		                th:value="${benefit.benefitDescription}"
		                th:text="${benefit.benefitName + ' - ' + benefit.benefitDescription}">
		        </option>
		      </select>
		    </div>
		    
		    <!-- 선택된 쿠폰 표시 영역 -->
		    <ul id="selectedBenefitsList" style="margin-top:10px; padding-left:20px;"></ul>
		    
		    <!-- 경고 문구 -->
		    <p id="benefitWarning" style="margin-top:10px; font-weight:bold; color:red;"></p>
		
		    <div id="cartItems"></div>
		    <p id="deliveryCharges"></p>
		    <p id="totalQuantity"></p>
		    <p id="totalPrice"></p>
		    <p id="purchaseTotal"></p>
		
		    <!-- 기존 숨겨진 장바구니 JSON 데이터 필드 -->
		    <input type="hidden" name="cartData" id="cartData" />
		    <input type="hidden" name="quantities" id="quantities" />
		    <input type="hidden" name="usedBenefits" id="usedBenefits" />
		    
		    <button type="submit">구매 확정</button>
		  </form>
		</main>
	    <footer class="mt-auto text-white-50">
    		<th:block th:insert="~{template/refresh/fragments/block :: footer}"></th:block>
    	</footer>
	    <script src="https://js.tosspayments.com/v1"></script>
		<script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
	    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	    <script src="/js/jquery-3.7.1.min.js"></script>
	    <script src="/assets/dist/mainproductboardjs/purchase.js"></script>
	    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	</body>
</html>