<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" class="h-100" data-bs-theme="auto">
	<head>
	    <th:block th:insert="~{template/refresh/fragments/block :: config}"></th:block>
	    <meta name="theme-color" content="#712cf9">
	    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
	    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
	    <link href="/assets/dist/css/refreshmain.css" rel="stylesheet">
	    <link href="/assets/dist/mainproductboardcss/PBoardDetail.css" rel="stylesheet"/>
	    <link rel="stylesheet" href="/assets/dist/fragmentscss/reviewcss.css"/>
	</head>
	<body class="d-flex h-100 text-center text-bg-dark">
	    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
	        <header class="mb-auto">
	            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
	                <th:block th:insert="~{template/refresh/fragments/block :: header}"></th:block>
	                <th:block th:insert="~{template/refresh/fragments/block :: brandName}"></th:block>
	                <th:block th:insert="~{template/refresh/fragments/block :: mainNavbar}"></th:block>
	                <th:block th:insert="~{template/refresh/fragments/block :: sideNavbar}"></th:block>
	            </nav>
	        </header>
	    </div>
		<main>
			<section class="detail-info">
			    <h2 th:text="${product.name}">상품명</h2>
			
				<img class="detail-image"
	     			th:src="@{/products/image/{id}(id=${product.productId})}"
	     			alt="상품 이미지"
	     			style="width:200px; height:200px; object-fit:cover;" />
				<hr />
			
			    <p><strong>판매자:</strong> <span th:text="${product.seller}">판매자</span></p>
			    <hr />
			
			    <p><strong>제조업체:</strong> <span th:text="${product.manufacturer}">제조업체</span></p>
			    <hr />
			
			    <p><strong>가격:</strong> ₩<span th:text="${product.price}"></span></p>
			    <hr />
			
			    <p><strong>재고:</strong> <span th:text="${product.stock}"></span></p>
			    <hr />
			
				<p><strong>등록일:</strong> <span th:text="${#dates.format(product.createdAt, 'yyyy-MM-dd')}"></span></p>
			    <hr />
			
			    <!-- 수량 선택 -->
			    <label for="quantity"><strong>수량 선택:</strong></label>
			    <input type="number" id="quantity" name="quantity" min="1" value="1" />
			    <hr />
			
			    <label for="detailOption"><strong>상세 옵션 선택:</strong></label>
	
				<!-- product.detailOption이 null이 아닐 때만 select 표시 -->
				<th:block th:if="${optionList != null}">
				    <select id="detailOption" name="detailOption" required>
				        <option value="" disabled selected>옵션 선택</option>
				        <option th:each="opt, iterStat : ${optionList}" 
						        th:value="${opt}"
						        th:text="|${opt} (+₩${optionPriceList[iterStat.index]})|">
						</option>
				    </select>
				</th:block>
				
				<th:block th:if="${optionList == null}">
				    <p><strong>상세 옵션:</strong> 없음</p>
				    <p><strong>최종 가격:</strong> <span id="finalPrice">₩<span th:text="${product.price}"></span></span></p>
				</th:block>
				
				
				<p><strong>등록일:</strong> <span th:text="${#dates.format(product.createdAt, 'yyyy-MM-dd')}"></span></p>
			    <hr />
			</section>

		    <!-- 버튼 그룹 -->
		    <section class="button-section">
				<button
				  id="addToCartBtn"
				  class="btn cart"
				  th:attr="data-id=${product.productId}, data-name=${product.name}, data-price=${product.price}, data-image=@{/products/image/{id}(id=${product.productId})}">
				  장바구니
				</button>
		        <button
			      id="buyNowBtn"
			      class="btn buy"
			      style="margin-left:10px;"
			      th:attr="data-id=${product.productId}, data-name=${product.name}, data-price=${product.price}, data-image=@{/products/image/{id}(id=${product.productId})}">
			      구매
			    </button>
		    </section>
		    <p th:text="${product.description}">상품 설명</p>
		        <hr />
		
		    <a th:href="@{/products}" class="btn back" style="margin-left:10px;">목록</a>
		
			<section class="review-section">
			    <h3>리뷰</h3>
			
			    <div th:if="${#lists.isEmpty(reviews)}">
			        <p class="no-review">리뷰가 아직 없습니다.</p>
			    </div>
			
			    <div th:each="review : ${reviews}">
			        <div class="review">
			            <div class="review-header">
			                <strong th:text="${review.userName}">사용자</strong>
			                <span class="stars">
						        <span th:each="i : ${#numbers.sequence(1, review.rating)}">★</span>
						        <span th:each="i : ${#numbers.sequence(1, 5 - review.rating)}">☆</span>
						    </span>
			            </div>
			            <div class="review-date" th:text="${#dates.format(review.createdAt, 'yyyy-MM-dd HH:mm')}">
			                2025-07-31 12:34
			            </div>
			            <p class="review-comment" th:text="${review.reviewComment}">리뷰 내용입니다.</p>
			        </div>
			    </div>
			</section>

		</main>
	    <!-- External Scripts -->
	    
	    <footer class="mt-auto text-white-50">
    		<th:block th:insert="~{template/refresh/fragments/block :: footer}"></th:block>
    	</footer>
	    
	    <script>
		  window.optionPriceList = [[${optionPriceList}]];
		</script>
		
	    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	    <script src="/js/jquery-3.7.1.min.js"></script>
	    <script src="/assets/dist/mainproductboardjs/Detail.js"></script>
	     <!-- 스크립트 분리 후 파일 포함 -->
	    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	</body>
</html>