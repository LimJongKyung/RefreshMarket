<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:fragment="config">
        <script src="/assets/dist/js/refreshnavbar.js"></script>
        <script src="/assets/dist/js/refreshmainlogin.js"></script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/>
        <title>Refresh Market</title>
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <link rel="shortcut icon" href="/images/icon.png"/>
        <link rel="apple-touch-icon" href="/images/icon.png"/>
        <link rel="stylesheet" href="/assets/dist/fragmentscss/comment.css"> <!-- css 링크 -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    </th:block>
</head>
<body>
	<th:block th:fragment="talk-commentCreate">
	    <h2 class="comment-title">댓글 작성</h2>
		
		<label for="name" class="comment-ID">작성자ID:</label>
		<a th:text="${userId}"></a>
	    
	    <form class="comment-form" action="/ALPBoard/insert" method="post">
	        <!-- postId를 Thymeleaf로 동적으로 삽입 -->
	        <input type="hidden" name="postId" th:value="${postId}">
	    	
	        <label for="content" class="comment-label">댓글 내용:</label>
	        <textarea id="content" name="content" class="comment-textarea" required></textarea>
	    
	        <button type="submit" class="comment-button">작성</button>
	    </form>
	</th:block>

	<th:block th:fragment="talk-comment" th:each="comment : ${comments}">
	    <ul class="comment-list">
	        <li class="comment-item">
	            <!-- 댓글 작성자 -->
	            <div class="comment-author"><strong th:text="${comment.memberId}"></strong></div>
	
	            <!-- 댓글 작성일 -->
	            <span th:text="${#temporals.format(myDate, 'yyyy-MM-dd')}"></span>
	            
	            <!-- 댓글 내용 -->
	            <p class="comment-content" th:text="${comment.content}"></p>
	
	            <!-- 댓글 좋아요 수 -->
	            <!-- <span class="comment-like">좋아요: <span th:text="${comment.likeCount}"></span></span> -->
				<span class="comment-like" onclick="increaseLike([[${comment.commentId}]])">
				    좋아요: <span id="likeCount" th:text="${comment.likeCount}"></span>
				</span>
				
				
	            <!-- 댓글 수정일 -->
	            <!-- <div th:if="${comment.updatedDate != null}" class="comment-update">
	                <small>수정일: <span th:text="${#dates.format(comment.updatedDate, 'yyyy-MM-dd HH:mm:ss')}"></span></small>
	            </div>  -->
	        </li>
	    </ul>
	</th:block>
    <script src="assets/dist/fragmentsjs.js"></script>
	<script>
	    document.addEventListener("DOMContentLoaded", function() {
	        const postId = new URLSearchParams(window.location.search).get("postId");
	        if (postId) {
	            document.querySelector("input[name='postId']").value = postId;
	        }
	    });
	    
	    function increaseLike(commentId) {
	        fetch(`/comment/like/${commentId}`, {
	            method: "POST",
	        })
	        .then(response => response.json())
	        .then(data => {
	            if (data.success) {
	                document.getElementById("likeCount").innerText = data.likeCount;
	            } else {
	                alert("좋아요 반영 실패");
	            }
	        })
	        .catch(error => console.error("Error:", error));
	    }
	</script>
</body>
</html>