<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:fragment="config">
        <script src="/assets/dist/js/refreshnavbar.js"></script>
        <script src="/assets/dist/js/refreshmainlogin.js"></script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/>
        <title>Refresh Market</title>
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <link rel="shortcut icon" href="/images/icon.png"/>
        <link rel="apple-touch-icon" href="/images/icon.png"/>
        <link rel="stylesheet" href="/assets/dist/fragmentscss/comment.css"> <!-- css 링크 -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    </th:block>
</head>
<body>
	<th:block th:fragment="talk-commentCreate">
	    <h2 class="comment-title">댓글 작성</h2>
		
		<label for="name" class="comment-ID">작성자ID:</label>
		<a th:text="${userId}"></a>
	    
	    <form class="comment-form" action="/ALPBoard/insert" method="post">
	        <!-- postId를 Thymeleaf로 동적으로 삽입 -->
	        <input type="hidden" name="postId" th:value="${postId}">
	    	
	        <label for="content" class="comment-label">댓글 내용:</label>
	        <textarea id="content" name="content" class="comment-textarea" required></textarea>
	    
	        <button type="submit" class="comment-button">작성</button>
	    </form>
	</th:block>

	<th:block th:fragment="talk-comment">
	    <ul class="comment-list">
	        <li class="comment-item" th:each="comment : ${comments}">
			    <div class="comment-author">
			        <strong th:text="${comment.memberId}"></strong>
			    </div>
			
			    <span th:if="${comment.createdDate != null}"
			          th:text="${#temporals.format(comment.createdDate, 'yyyy-MM-dd')}"></span>
			
			    <!-- 원래 댓글 내용 -->
			    <p th:id="'content-' + ${comment.commentId}" th:text="${comment.content}"></p>
			
			    <!-- 수정 input (초기에는 숨김) -->
			    <input type="text" th:id="'editInput-' + ${comment.commentId}"
			           th:value="${comment.content}" style="display:none;" />
			
			    <span class="comment-like" onclick="increaseLike([[${comment.commentId}]])">
			        좋아요: <span id="likeCount" th:text="${comment.likeCount}"></span>
			    </span>
			
			    <div th:if="${comment.updatedDate != null}" class="comment-update">
			        <small>수정일: <span th:text="${comment.updatedDate}"></span></small>
			    </div>
			
			    <!-- 로그인 사용자와 댓글 작성자가 같을 때만 표시 -->
			    <div class="comment-actions" th:if="${userId != null and userId == comment.memberId}">
			        <!-- 수정 버튼 -->
			        <button type="button" th:onclick="'enableEdit(' + ${comment.commentId} + ')'">✏️ 수정</button>
			
			        <!-- 저장 버튼 -->
					<button type="button" th:onclick="'submitEdit(' + ${comment.commentId} + ')'">✅ 저장</button>
			
			        <!-- 삭제 버튼 (POST 방식) -->
			        <form th:action="@{/ALPBoard/deleteComment}" method="post" style="display:inline;">
			            <input type="hidden" name="commentId" th:value="${comment.commentId}" />
			            <input type="hidden" name="postId" th:value="${postId}" />
			            <button type="submit" onclick="return confirm('정말 삭제하시겠습니까?');">🗑️ 삭제</button>
			        </form>
			    </div>
			</li>
	    </ul>
	
	    <!-- 페이징 -->
	    <div class="pagination">
		    <ul>
		        <!-- 댓글이 없을 때 -->
		        <li th:if="${totalPages == 0}">
		        	<p>댓글이 없습니다!</p>
		        </li>
		
		        <!-- 댓글이 있을 때 -->
		        <li th:if="${totalPages > 0 and currentPage > 1}">
		            <a th:href="@{/ALPBoard/LBDetail(postId=${postId}, page=${currentPage - 1})}">이전</a>
		        </li>
		
		        <li th:each="i : ${#numbers.sequence(1, totalPages)}" th:if="${totalPages > 0}">
		            <a th:href="@{/ALPBoard/LBDetail(postId=${postId}, page=${i})}"
		               th:text="${i}"
		               th:classappend="${i == currentPage} ? 'active' : ''"></a>
		        </li>
		
		        <li th:if="${totalPages > 0 and currentPage < totalPages}">
		            <a th:href="@{/ALPBoard/LBDetail(postId=${postId}, page=${currentPage + 1})}">다음</a>
		        </li>
		    </ul>
		</div>	
	</th:block>
</body>
</html>